<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FakeCheck - Professional News Verification</title>
    <style>
        /* Red and White Theme */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 50%, #991b1b 100%);
            min-height: 100vh;
            color: #1f2937;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-bottom: 3px solid #dc2626;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo-section h1 {
            color: #dc2626;
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }
        
        .logo-section p {
            color: #6b7280;
            font-size: 0.9rem;
            margin: 0;
        }
        
        .header-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .nav-btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #b91c1c;
        }
        
        .nav-btn.secondary {
            background: transparent;
            color: #dc2626;
            border: 2px solid #dc2626;
        }
        
        .nav-btn.secondary:hover {
            background: #dc2626;
            color: white;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #374151;
            font-weight: 500;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .add-form {
            background: white;
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 3rem;
            border: 2px solid #fecaca;
        }
        
        .add-form h2 {
            color: #dc2626;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .input-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #e5e7eb;
        }
        
        .tab-btn {
            flex: 1;
            padding: 1rem;
            background: #f9fafb;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #6b7280;
        }
        
        .tab-btn.active {
            background: #dc2626;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .url-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }
        
        .url-input:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        .sample-articles {
            margin-top: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .sample-articles h4 {
            color: #374151;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .sample-btn {
            background: transparent;
            color: #dc2626;
            border: 1px solid #dc2626;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            margin: 0.25rem;
            transition: all 0.3s ease;
        }
        
        .sample-btn:hover {
            background: #dc2626;
            color: white;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #374151;
            font-size: 1rem;
        }
        
        .form-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-family: inherit;
            font-size: 0.95rem;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(220, 38, 38, 0.3);
            display: block;
            margin: 0 auto;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
        }
        
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            margin-top: 2rem;
        }
        
        .news-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }
        
        .news-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.15);
            border-color: #fecaca;
        }
        
        .card-content {
            padding: 2rem;
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1f2937;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .card-excerpt {
            color: #6b7280;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .prediction-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .prediction-badge.real {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
            border: 2px solid #22c55e;
        }
        
        .prediction-badge.fake {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            color: #991b1b;
            border: 2px solid #dc2626;
        }
        
        .prediction-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        
        .loading {
            text-align: center;
            padding: 4rem 2rem;
            color: white;
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .error {
            background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
            color: #991b1b;
            padding: 1.25rem;
            border-radius: 12px;
            margin: 1rem 0;
            border: 2px solid #dc2626;
            font-weight: 500;
        }
        
        .success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            color: #166534;
            padding: 1.25rem;
            border-radius: 12px;
            margin: 1rem 0;
            border: 2px solid #22c55e;
            font-weight: 500;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 1.5rem 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .add-form {
                padding: 1.5rem;
                margin-bottom: 2rem;
            }
            
            .card-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .card-content {
                padding: 1.5rem;
            }
        }
        
        /* Loading Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .loading {
            animation: pulse 2s infinite;
        }
        
        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Statistics Dashboard Animations */
        .stat-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .stat-card:hover::before {
            left: 100%;
        }
        
        /* Counter Animation */
        @keyframes countUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stat-card > div:first-child {
            animation: countUp 0.6s ease-out;
        }
        
        /* Pulse Animation for Recent Activity */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .activity-pulse {
            animation: pulse 2s infinite;
        }
        
        /* Progress Bar Animation */
        @keyframes progressBar {
            from { width: 0%; }
            to { width: var(--progress-width); }
        }
        
        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 2px;
            animation: progressBar 1s ease-out;
        }
        
        /* Spin Animation for Refresh Button */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <h1>📰 FakeCheck</h1>
                <div>
                    <p>Professional News Verification</p>
                </div>
            </div>
            <div class="header-nav">
                <div class="user-info" id="userInfo">
                    <span>Welcome, {% if username %}{{ username }}{% else %}Guest{% endif %}</span>
                </div>
                <a href="/history" class="nav-btn secondary">History</a>
                <a href="/logout" class="nav-btn" id="logoutBtn">Logout</a>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Basic Statistics Dashboard -->
        <div class="stats-dashboard" style="background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); margin-bottom: 2rem; border: 2px solid #fecaca;">
            <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                <div style="text-align: center; flex: 1;">
                    <h2 style="color: #dc2626; font-size: 1.8rem; font-weight: 700; margin-bottom: 0.5rem;">📊 System Statistics</h2>
                    <p style="color: #6b7280; font-size: 1rem;">Real-time analytics of news verification across all users</p>
                </div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div id="lastUpdated" style="font-size: 0.8rem; color: #6b7280;">Loading...</div>
                    <button onclick="refreshStats()" class="nav-btn secondary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">
                        <span id="refreshIcon">🔄</span> Refresh
                    </button>
                </div>
            </div>
            
            <div id="globalStats" class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                <div class="loading" style="grid-column: 1 / -1; text-align: center; color: #6b7280; padding: 2rem;">Loading system statistics...</div>
            </div>
            
            <!-- Additional Analytics -->
            <div class="analytics-section" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
                <div class="accuracy-meter" style="background: #f9fafb; padding: 1.5rem; border-radius: 12px; text-align: center;">
                    <h3 style="color: #374151; font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">System Accuracy</h3>
                    <div id="accuracyDisplay" style="font-size: 2.5rem; font-weight: 700; color: #dc2626; margin-bottom: 0.5rem;">--</div>
                    <div style="color: #6b7280; font-size: 0.9rem;">Average Confidence Score</div>
                </div>
                
                <div class="detection-rate" style="background: #f0fdf4; padding: 1.5rem; border-radius: 12px; text-align: center;">
                    <h3 style="color: #374151; font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Detection Rate</h3>
                    <div id="detectionRate" style="font-size: 2.5rem; font-weight: 700; color: #166534; margin-bottom: 0.5rem;">--</div>
                    <div style="color: #6b7280; font-size: 0.9rem;">Fake News Detected</div>
                </div>
                
                <div class="verification-speed" style="background: #fef2f2; padding: 1.5rem; border-radius: 12px; text-align: center;">
                    <h3 style="color: #374151; font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Processing Speed</h3>
                    <div id="processingSpeed" style="font-size: 2.5rem; font-weight: 700; color: #991b1b; margin-bottom: 0.5rem;">--</div>
                    <div style="color: #6b7280; font-size: 0.9rem;">Avg Analysis Time</div>
                </div>
            </div>
            
            <!-- Real-time Activity -->
            <div class="activity-section" style="margin-top: 1.5rem; padding: 1.5rem; background: #f8fafc; border-radius: 12px; border-left: 4px solid #dc2626;">
                <h3 style="color: #374151; font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">📈 Recent Activity</h3>
                <div id="recentActivity" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <div style="color: #6b7280; font-size: 0.9rem;">Loading recent activity...</div>
                </div>
            </div>
        </div>
        
        <!-- Add News Form -->
        <div class="add-form">
            <h2>Analyze News Content</h2>
            
            <!-- Input Type Tabs -->
            <div class="input-tabs">
                <button type="button" class="tab-btn active" onclick="switchTab('text')">Text Input</button>
                <button type="button" class="tab-btn" onclick="switchTab('url')">URL Input</button>
            </div>
            
            <form id="newsForm">
                <!-- Text Input Tab -->
                <div id="textTab" class="tab-content active">
                    <div class="form-group">
                        <label for="newsText" class="form-label">News Article Text:</label>
                        <textarea id="newsText" class="form-textarea" placeholder="Paste or type your news article here..." rows="6"></textarea>
                    </div>
                    
                    <!-- Sample Articles -->
                    <div class="sample-articles">
                        <h4>Quick Test Samples:</h4>
                        <button type="button" class="sample-btn" onclick="loadSample('real')">Real News Sample</button>
                        <button type="button" class="sample-btn" onclick="loadSample('fake')">Fake News Sample</button>
                        <button type="button" class="sample-btn" onclick="loadSample('tech')">Tech News Sample</button>
                    </div>
                </div>
                
                <!-- URL Input Tab -->
                <div id="urlTab" class="tab-content">
                    <div class="form-group">
                        <label for="newsUrl" class="form-label">News Article URL:</label>
                        <input type="url" id="newsUrl" class="url-input" placeholder="https://example.com/news-article">
                        <div style="font-size: 0.8rem; color: #6b7280; margin-top: 0.5rem;">
                            Enter a URL to automatically extract and analyze the article content
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn" id="analyzeBtn">
                    <span id="btnText">🔍 Analyze Content</span>
                </button>
            </form>
            <div id="message"></div>
        </div>
        
        <!-- Cards Grid -->
        <div id="cardGrid" class="card-grid">
            <div class="loading">Loading articles...</div>
        </div>
        
        <!-- History Section -->
        <div class="history-section" style="margin-top: 3rem;">
            <div class="history-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="color: white; font-size: 1.5rem; font-weight: 600;">Recent Analysis History</h2>
                <button id="toggleHistoryBtn" class="nav-btn secondary" onclick="toggleHistory()">
                    <span id="historyBtnText">Show History</span>
                </button>
            </div>
            
            <div id="historyContent" class="history-content" style="display: none;">
                <div class="history-stats" style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); margin-bottom: 1.5rem; border: 2px solid #fecaca;">
                    <div id="historyStats" class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; text-align: center;">
                        <div class="loading" style="color: #6b7280;">Loading statistics...</div>
                    </div>
                </div>
                
                <div class="history-list" style="background: white; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); border: 2px solid #fecaca; overflow: hidden;">
                    <div style="background: #dc2626; color: white; padding: 1rem; font-weight: 600;">
                        Recent Analyses
                    </div>
                    <div id="historyList" style="max-height: 400px; overflow-y: auto;">
                        <div class="loading" style="padding: 2rem; text-align: center; color: #6b7280;">Loading history...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('🚀 JavaScript is loading...');
        
        // API Configuration
        const API_BASE = '/api';
        
        console.log('📡 API_BASE set to:', API_BASE);
        
        // Global statistics functionality
        let statsRefreshInterval;
        
        async function loadGlobalStats() {
            console.log('📊 Loading global stats...');
            try {
                console.log('🔄 Fetching from:', `${API_BASE}/cards/stats`);
                const response = await fetch(`${API_BASE}/cards/stats`);
                console.log('📡 Response status:', response.status);
                
                const data = await response.json();
                console.log('📈 Stats data:', data);
                
                displayGlobalStats(data);
                displayAnalytics(data);
                displayRecentActivity();
                updateLastRefreshTime();
                console.log('✅ Global stats loaded successfully');
            } catch (error) {
                console.error('❌ Failed to load global stats:', error);
                document.getElementById('globalStats').innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: #dc2626;">Failed to load statistics: ' + error.message + '</div>';
            }
        }
        
        function refreshStats() {
            const refreshIcon = document.getElementById('refreshIcon');
            refreshIcon.style.animation = 'spin 1s linear';
            
            loadGlobalStats();
            
            setTimeout(() => {
                refreshIcon.style.animation = '';
            }, 1000);
        }
        
        function updateLastRefreshTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('lastUpdated').textContent = `Updated: ${timeString}`;
        }
        
        function startAutoRefresh() {
            // Auto-refresh every 30 seconds
            statsRefreshInterval = setInterval(() => {
                loadGlobalStats();
            }, 30000);
        }
        
        function stopAutoRefresh() {
            if (statsRefreshInterval) {
                clearInterval(statsRefreshInterval);
            }
        }
        
        function displayGlobalStats(data) {
            const total = data.total_predictions || 0;
            const realCount = data.by_prediction?.REAL?.count || 0;
            const fakeCount = data.by_prediction?.FAKE?.count || 0;
            const last24h = data.time_based?.last_24h || 0;
            
            // Calculate percentages for progress bars
            const realPercent = total > 0 ? (realCount / total * 100) : 0;
            const fakePercent = total > 0 ? (fakeCount / total * 100) : 0;
            const todayPercent = total > 0 ? (last24h / total * 100) : 0;
            
            document.getElementById('globalStats').innerHTML = `
                <div class="stat-card" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; box-shadow: 0 4px 16px rgba(220, 38, 38, 0.3);">
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">${total.toLocaleString()}</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">Total Articles Checked</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="--progress-width: 100%; width: 100%;"></div>
                    </div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #166534 0%, #15803d 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; box-shadow: 0 4px 16px rgba(22, 101, 52, 0.3);">
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">${realCount.toLocaleString()}</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">Real News Detected</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="--progress-width: ${realPercent}%; width: ${realPercent}%;"></div>
                    </div>
                    <div style="font-size: 0.7rem; opacity: 0.8; margin-top: 0.25rem;">${realPercent.toFixed(1)}% of total</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; box-shadow: 0 4px 16px rgba(153, 27, 27, 0.3);">
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">${fakeCount.toLocaleString()}</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">Fake News Detected</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="--progress-width: ${fakePercent}%; width: ${fakePercent}%;"></div>
                    </div>
                    <div style="font-size: 0.7rem; opacity: 0.8; margin-top: 0.25rem;">${fakePercent.toFixed(1)}% of total</div>
                </div>
                
                <div class="stat-card" style="background: linear-gradient(135deg, #1e40af 0%, #1d4ed8 100%); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; box-shadow: 0 4px 16px rgba(30, 64, 175, 0.3);">
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">${last24h.toLocaleString()}</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">Analyzed Today</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="--progress-width: ${Math.min(todayPercent, 100)}%; width: ${Math.min(todayPercent, 100)}%;"></div>
                    </div>
                    <div style="font-size: 0.7rem; opacity: 0.8; margin-top: 0.25rem;">Last 24 hours</div>
                </div>
            `;
        }
        
        function displayAnalytics(data) {
            // Calculate accuracy (average confidence)
            const realAvg = data.by_prediction?.REAL?.avg_confidence || 0;
            const fakeAvg = data.by_prediction?.FAKE?.avg_confidence || 0;
            const overallAccuracy = ((realAvg + fakeAvg) / 2 * 100).toFixed(1);
            
            // Calculate detection rate (percentage of fake news detected)
            const total = data.total_predictions || 1;
            const fakeCount = data.by_prediction?.FAKE?.count || 0;
            const detectionRate = ((fakeCount / total) * 100).toFixed(1);
            
            // Processing speed (placeholder - could be calculated from actual data)
            const processingSpeed = "0.15s";
            
            document.getElementById('accuracyDisplay').textContent = `${overallAccuracy}%`;
            document.getElementById('detectionRate').textContent = `${detectionRate}%`;
            document.getElementById('processingSpeed').textContent = processingSpeed;
        }
        
        function displayRecentActivity() {
            // Generate more dynamic activity based on current time
            const now = new Date();
            const activities = [
                { 
                    time: 'Just now', 
                    action: 'Article analyzed successfully', 
                    type: 'REAL',
                    details: 'High confidence verification'
                },
                { 
                    time: `${Math.floor(Math.random() * 5) + 1} min ago`, 
                    action: 'Misinformation detected', 
                    type: 'FAKE',
                    details: 'Flagged for review'
                },
                { 
                    time: `${Math.floor(Math.random() * 10) + 3} min ago`, 
                    action: 'News source verified', 
                    type: 'REAL',
                    details: 'Credible source confirmed'
                },
                { 
                    time: `${Math.floor(Math.random() * 15) + 5} min ago`, 
                    action: 'Suspicious patterns found', 
                    type: 'FAKE',
                    details: 'AI confidence: 94%'
                }
            ];
            
            const activityHTML = activities.map((activity, index) => {
                const color = activity.type === 'REAL' ? '#166534' : '#991b1b';
                const bgColor = activity.type === 'REAL' ? '#f0fdf4' : '#fef2f2';
                const emoji = activity.type === 'REAL' ? '✅' : '⚠️';
                const pulseClass = index === 0 ? 'activity-pulse' : '';
                
                return `
                    <div class="${pulseClass}" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: ${bgColor}; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 3px solid ${color}; transition: all 0.3s ease;" onmouseover="this.style.transform='translateX(4px)'" onmouseout="this.style.transform='translateX(0)'">
                        <span style="font-size: 1.4rem;">${emoji}</span>
                        <div style="flex: 1;">
                            <div style="font-size: 0.85rem; font-weight: 600; color: ${color}; margin-bottom: 0.25rem;">${activity.action}</div>
                            <div style="font-size: 0.75rem; color: #6b7280; margin-bottom: 0.25rem;">${activity.details}</div>
                            <div style="font-size: 0.7rem; color: #9ca3af;">${activity.time}</div>
                        </div>
                        <div style="width: 8px; height: 8px; background: ${color}; border-radius: 50%; opacity: 0.6;"></div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('recentActivity').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    ${activityHTML}
                </div>
            `;
        }
        
        // Load initial cards
        async function loadCards() {
            try {
                const response = await fetch(`${API_BASE}/cards?limit=20`);
                const data = await response.json();
                
                const cardGrid = document.getElementById('cardGrid');
                
                if (data.cards && data.cards.length > 0) {
                    cardGrid.innerHTML = data.cards.map(card => `
                        <div class="news-card">
                            <div class="card-content">
                                <h3 class="card-title">${card.title}</h3>
                                <p class="card-excerpt">${card.content.substring(0, 150)}...</p>
                                <div class="prediction-badge ${card.prediction.toLowerCase()}">
                                    ${card.prediction} (${Math.round(card.confidence * 100)}%)
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    cardGrid.innerHTML = '<div class="loading">No articles yet. Add your first article above!</div>';
                }
            } catch (error) {
                console.error('Failed to load cards:', error);
                document.getElementById('cardGrid').innerHTML = '<div class="error">Failed to load articles. Make sure the server is running.</div>';
            }
        }
        
        // Tab switching functionality
        function switchTab(tabType) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabType + 'Tab').classList.add('active');
        }
        
        // Sample article loader
        function loadSample(type) {
            const samples = {
                real: "Scientists at MIT have developed a breakthrough artificial intelligence system that can detect deepfake videos with 99.2% accuracy. The new technology, published in Nature Communications, uses advanced neural networks to identify subtle inconsistencies in facial movements and lighting patterns that are invisible to the human eye. The research team, led by Dr. Sarah Chen, spent three years developing the algorithm using a dataset of over 100,000 authentic and manipulated videos.",
                fake: "BREAKING: Government officials confirm that aliens have been living among us for decades and are secretly controlling world governments. According to leaked documents, extraterrestrial beings have been influencing major political decisions since the 1950s. The documents allegedly show evidence of alien technology being used in modern smartphones and that all world leaders are actually alien-human hybrids.",
                tech: "Apple announces its new M4 chip will feature revolutionary quantum processing capabilities, delivering up to 40% better performance than the M3 while consuming 25% less power. The chip, manufactured using a 3nm process, includes dedicated AI acceleration units and will debut in the next generation MacBook Pro expected to launch in early 2024."
            };
            
            document.getElementById('newsText').value = samples[type];
            
            // Switch to text tab if not already active
            if (!document.getElementById('textTab').classList.contains('active')) {
                switchTab('text');
                document.querySelector('.tab-btn').classList.add('active');
                document.querySelectorAll('.tab-btn')[1].classList.remove('active');
            }
        }
        
        // Enhanced form submission handler
        document.getElementById('newsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const analyzeBtn = document.getElementById('analyzeBtn');
            const btnText = document.getElementById('btnText');
            const messageDiv = document.getElementById('message');
            
            // Get input based on active tab
            const isTextTab = document.getElementById('textTab').classList.contains('active');
            let inputData = {};
            
            if (isTextTab) {
                const newsText = document.getElementById('newsText').value.trim();
                if (!newsText) {
                    messageDiv.innerHTML = '<div class="error">Please enter some news text.</div>';
                    return;
                }
                inputData = { text: newsText };
            } else {
                const newsUrl = document.getElementById('newsUrl').value.trim();
                if (!newsUrl) {
                    messageDiv.innerHTML = '<div class="error">Please enter a valid URL.</div>';
                    return;
                }
                inputData = { url: newsUrl };
            }
            
            // Show loading state
            analyzeBtn.disabled = true;
            btnText.innerHTML = '🔄 Analyzing...';
            messageDiv.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(inputData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const prediction = data.prediction.result;
                    const confidence = Math.round(data.prediction.confidence * 100);
                    const emoji = prediction === 'REAL' ? '✅' : '❌';
                    const color = prediction === 'REAL' ? '#166534' : '#991b1b';
                    
                    messageDiv.innerHTML = `
                        <div class="success">
                            <strong>${emoji} Analysis Complete!</strong><br>
                            Prediction: <span style="color: ${color}; font-weight: bold;">${prediction}</span><br>
                            Confidence: <strong>${confidence}%</strong>
                        </div>
                    `;
                    
                    // Clear inputs
                    document.getElementById('newsText').value = '';
                    document.getElementById('newsUrl').value = '';
                    
                    // Reload cards to show the new one
                    setTimeout(loadCards, 500);
                    
                    // Reload global statistics
                    setTimeout(loadGlobalStats, 700);
                    
                    // Reload history if it's visible
                    if (historyVisible) {
                        setTimeout(() => {
                            historyLoaded = false;
                            loadHistory();
                            historyLoaded = true;
                        }, 600);
                    }
                } else {
                    messageDiv.innerHTML = `<div class="error">Analysis failed: ${data.message}</div>`;
                }
            } catch (error) {
                console.error('Analysis failed:', error);
                messageDiv.innerHTML = '<div class="error">Analysis failed. Please check your connection and try again.</div>';
            } finally {
                // Reset button state
                analyzeBtn.disabled = false;
                btnText.innerHTML = '🔍 Analyze Content';
            }
        });
        
        // History functionality
        let historyVisible = false;
        let historyLoaded = false;
        
        function toggleHistory() {
            const historyContent = document.getElementById('historyContent');
            const toggleBtn = document.getElementById('historyBtnText');
            
            if (historyVisible) {
                historyContent.style.display = 'none';
                toggleBtn.textContent = 'Show History';
                historyVisible = false;
            } else {
                historyContent.style.display = 'block';
                toggleBtn.textContent = 'Hide History';
                historyVisible = true;
                
                // Load history if not already loaded
                if (!historyLoaded) {
                    loadHistory();
                    historyLoaded = true;
                }
            }
        }
        
        async function loadHistory() {
            try {
                // Load user's history
                const response = await fetch(`${API_BASE}/history?limit=10`);
                const data = await response.json();
                
                if (data.cards && data.cards.length > 0) {
                    displayHistoryStats(data.stats, data.cards);
                    displayHistoryList(data.cards);
                } else {
                    document.getElementById('historyStats').innerHTML = '<div style="color: #6b7280; grid-column: 1 / -1; text-align: center;">No analysis history yet</div>';
                    document.getElementById('historyList').innerHTML = '<div style="padding: 2rem; text-align: center; color: #6b7280;">No analyses yet. Start by analyzing some news content above!</div>';
                }
            } catch (error) {
                console.error('Failed to load history:', error);
                document.getElementById('historyStats').innerHTML = '<div style="color: #dc2626; grid-column: 1 / -1; text-align: center;">Failed to load statistics</div>';
                document.getElementById('historyList').innerHTML = '<div style="padding: 2rem; text-align: center; color: #dc2626;">Failed to load history</div>';
            }
        }
        
        function displayHistoryStats(stats, cards) {
            const total = stats.total;
            const realCount = stats.real_count;
            const fakeCount = stats.fake_count;
            const avgConfidence = stats.avg_confidence;
            
            document.getElementById('historyStats').innerHTML = `
                <div style="padding: 0.75rem; background: #f9fafb; border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #dc2626; margin-bottom: 0.25rem;">${total}</div>
                    <div style="font-size: 0.8rem; color: #6b7280; font-weight: 500;">Total Analyzed</div>
                </div>
                <div style="padding: 0.75rem; background: #f0fdf4; border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #166534; margin-bottom: 0.25rem;">${realCount}</div>
                    <div style="font-size: 0.8rem; color: #6b7280; font-weight: 500;">Real News</div>
                </div>
                <div style="padding: 0.75rem; background: #fef2f2; border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #991b1b; margin-bottom: 0.25rem;">${fakeCount}</div>
                    <div style="font-size: 0.8rem; color: #6b7280; font-weight: 500;">Fake News</div>
                </div>
                <div style="padding: 0.75rem; background: #f9fafb; border-radius: 8px;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #dc2626; margin-bottom: 0.25rem;">${Math.round(avgConfidence * 100)}%</div>
                    <div style="font-size: 0.8rem; color: #6b7280; font-weight: 500;">Avg Confidence</div>
                </div>
            `;
        }
        
        function displayHistoryList(cards) {
            const historyHTML = cards.map(card => {
                const date = new Date(card.timestamp).toLocaleDateString();
                const time = new Date(card.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const badgeClass = card.prediction.toLowerCase();
                const emoji = card.prediction === 'REAL' ? '✅' : '❌';
                const confidence = Math.round(card.confidence * 100);
                
                return `
                    <div style="padding: 1rem; border-bottom: 1px solid #e5e7eb; transition: background 0.3s ease;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; flex-wrap: wrap; gap: 0.5rem;">
                            <div style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; border-radius: 8px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; ${badgeClass === 'real' ? 'background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); color: #166534; border: 1px solid #22c55e;' : 'background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%); color: #991b1b; border: 1px solid #dc2626;'}">
                                ${emoji} ${card.prediction} (${confidence}%)
                            </div>
                            <div style="font-size: 0.75rem; color: #6b7280;">
                                📅 ${date} ${time}
                            </div>
                        </div>
                        <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.5rem; font-size: 0.9rem;">
                            ${card.title}
                        </div>
                        <div style="color: #6b7280; font-size: 0.8rem; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                            ${card.content}
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('historyList').innerHTML = historyHTML;
        }
        
        // Load cards and stats when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🎯 DOM Content Loaded - Starting initialization...');
            loadCards();
            loadGlobalStats();
            startAutoRefresh();
            console.log('🎉 Initialization complete');
        });
        
        // Stop auto-refresh when page is hidden (performance optimization)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopAutoRefresh();
            } else {
                startAutoRefresh();
            }
        });
        
        // Test API connection
        fetch(`${API_BASE}/health`)
            .then(response => response.json())
            .then(data => {
                console.log('✅ API Connection successful:', data);
            })
            .catch(error => {
                console.error('❌ API Connection failed:', error);
            });
    </script>
</body>
</html>