<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake News Detector | GeeksforGeeks Style</title>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        /* GeeksforGeeks Header */
        .gfg-header {
            background: #fff;
            border-bottom: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
        }
        
        .gfg-logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: #0f9d58;
            font-weight: 700;
            font-size: 24px;
        }
        
        .gfg-logo .logo-icon {
            width: 40px;
            height: 40px;
            background: #0f9d58;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            margin-right: 12px;
        }
        
        .header-nav {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .nav-link {
            color: #333;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
            transition: color 0.2s;
        }
        
        .nav-link:hover {
            color: #0f9d58;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #666;
            font-size: 14px;
        }
        
        .btn-logout {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s;
        }
        
        .btn-logout:hover {
            background: #c82333;
        }
        
        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Hero Section */
        .hero-section {
            background: white;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            text-align: center;
        }
        
        .hero-title {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 12px;
        }
        
        .hero-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
        }
        
        /* Analysis Form */
        .analysis-form {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .form-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 16px;
        }
        
        .form-textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.2s;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #0f9d58;
            box-shadow: 0 0 0 3px rgba(15, 157, 88, 0.1);
        }
        
        .btn-primary {
            background: #0f9d58;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: block;
            margin: 0 auto;
        }
        
        .btn-primary:hover {
            background: #0d8043;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(15, 157, 88, 0.3);
        }
        
        .btn-primary:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Sample Articles */
        .sample-articles {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .sample-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .sample-btn {
            background: transparent;
            color: #0f9d58;
            border: 1px solid #0f9d58;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            margin: 4px;
            transition: all 0.2s;
        }
        
        .sample-btn:hover {
            background: #0f9d58;
            color: white;
        }
        
        /* Alert Messages */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Statistics Section */
        .stats-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .stats-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #0f9d58;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        
        /* Articles Section */
        .articles-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .articles-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .article-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e9ecef;
            transition: all 0.2s;
        }
        
        .article-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .article-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .article-content {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .article-prediction {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .article-prediction.real {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .article-prediction.fake {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .article-meta {
            font-size: 12px;
            color: #999;
            margin-top: 10px;
        }
        
        /* Loading States */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 16px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #e9ecef;
            border-top: 2px solid #0f9d58;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .header-nav {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .main-container {
                padding: 15px;
            }
            
            .hero-section,
            .analysis-form,
            .stats-section,
            .articles-section {
                padding: 20px;
            }
            
            .hero-title {
                font-size: 24px;
            }
            
            .hero-subtitle {
                font-size: 16px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .articles-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- GeeksforGeeks Style Header -->
    <header class="gfg-header">
        <div class="header-container">
            <a href="/" class="gfg-logo">
                <div class="logo-icon">📰</div>
                FakeNewsDetector
            </a>
            <nav class="header-nav">
                <a href="/" class="nav-link">Home</a>
                <a href="/history" class="nav-link">History</a>
                <div class="user-info">
                    <span>Welcome, {% if username %}{{ username }}{% else %}Guest{% endif %}</span>
                    <a href="/logout" class="btn-logout">Logout</a>
                </div>
            </nav>
        </div>
    </header>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Hero Section -->
        <section class="hero-section">
            <h1 class="hero-title">AI-Powered Fake News Detection</h1>
            <p class="hero-subtitle">Analyze news articles with advanced machine learning algorithms to detect misinformation and verify credibility</p>
        </section>
        
        <!-- Analysis Form -->
        <section class="analysis-form">
            <h2 class="form-title">Analyze News Article</h2>
            
            <!-- Analysis Type Tabs -->
            <div class="analysis-tabs" style="display: flex; margin-bottom: 20px; border-radius: 8px; overflow: hidden; border: 2px solid #e9ecef;">
                <button type="button" class="tab-btn active" onclick="switchTab('text')" style="flex: 1; padding: 12px; background: #0f9d58; color: white; border: none; cursor: pointer; font-weight: 600;">Text Analysis</button>
                <button type="button" class="tab-btn" onclick="switchTab('url')" style="flex: 1; padding: 12px; background: #f8f9fa; color: #333; border: none; cursor: pointer; font-weight: 600;">URL Analysis</button>
            </div>
            
            <!-- Text Analysis Tab -->
            <div id="textTab" class="tab-content">
                <form id="newsForm">
                    <div class="form-group">
                        <label for="newsText" class="form-label">Enter News Article Text</label>
                        <textarea 
                            id="newsText" 
                            class="form-textarea" 
                            placeholder="Paste your news article text here for analysis..."
                        ></textarea>
                    </div>
                    
                    <!-- Sample Articles -->
                    <div class="sample-articles">
                        <div class="sample-title">Quick Test Samples:</div>
                        <button type="button" class="sample-btn" onclick="loadSample('real')">Real News Sample</button>
                        <button type="button" class="sample-btn" onclick="loadSample('fake')">Fake News Sample</button>
                        <button type="button" class="sample-btn" onclick="loadSample('tech')">Tech News Sample</button>
                    </div>
                    
                    <button type="submit" class="btn-primary" id="analyzeBtn">
                        <span id="btnText">Analyze Article</span>
                    </button>
                </form>
            </div>
            
            <!-- URL Analysis Tab -->
            <div id="urlTab" class="tab-content" style="display: none;">
                <form id="urlForm">
                    <div class="form-group">
                        <label for="newsUrl" class="form-label">Enter News Article URL</label>
                        <input 
                            type="url" 
                            id="newsUrl" 
                            class="form-textarea" 
                            style="min-height: auto; padding: 15px;"
                            placeholder="https://example.com/news-article"
                        />
                        <div style="font-size: 14px; color: #666; margin-top: 8px;">
                            📌 Enter a URL to automatically extract and analyze the article content
                        </div>
                    </div>
                    
                    <!-- Sample URLs -->
                    <div class="sample-articles">
                        <div class="sample-title">Try These Sample URLs:</div>
                        <button type="button" class="sample-btn" onclick="loadUrlSample('bbc')">BBC News</button>
                        <button type="button" class="sample-btn" onclick="loadUrlSample('reuters')">Reuters</button>
                        <button type="button" class="sample-btn" onclick="loadUrlSample('cnn')">CNN</button>
                    </div>
                    
                    <button type="submit" class="btn-primary" id="analyzeUrlBtn">
                        <span id="urlBtnText">Analyze URL</span>
                    </button>
                </form>
            </div>
            
            <div id="message"></div>
        </section>
        
        <!-- Statistics Section -->
        <section class="stats-section">
            <h2 class="stats-title">System Statistics</h2>
            <div id="statsGrid" class="stats-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    Loading statistics...
                </div>
            </div>
        </section>
        
        <!-- Real-time Monitoring Section -->
        <section class="monitoring-section" style="background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border: 1px solid #e9ecef;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-size: 24px; font-weight: 600; color: #333; margin: 0;">🔍 Real-time Monitoring</h2>
                <button onclick="refreshMonitoring()" class="btn-primary" style="padding: 8px 16px; font-size: 14px;">
                    🔄 Refresh
                </button>
            </div>
            
            <div id="monitoringGrid" class="stats-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    Loading monitoring data...
                </div>
            </div>
            
            <!-- Trending Topics -->
            <div id="trendingTopics" style="margin-top: 20px;">
                <h3 style="font-size: 18px; font-weight: 600; color: #333; margin-bottom: 15px;">📈 Trending Fake News Topics</h3>
                <div id="trendingList" class="loading">Loading trending topics...</div>
            </div>
        </section>

        <!-- Recent Articles -->
        <section class="articles-section">
            <h2 class="articles-title">Recent Analyses</h2>
            <div id="articlesGrid" class="articles-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    Loading articles...
                </div>
            </div>
        </section>
    </div>
    
    <script>
        // API Configuration
        const API_BASE = '/api';
        
        // Sample articles data
        const samples = {
            real: "Scientists at MIT have developed a breakthrough artificial intelligence system that can detect deepfake videos with 99.2% accuracy. The new technology, published in Nature Communications, uses advanced neural networks to identify subtle inconsistencies in facial movements and lighting patterns that are invisible to the human eye. The research team, led by Dr. Sarah Chen, spent three years developing the algorithm using a dataset of over 100,000 authentic and manipulated videos.",
            fake: "BREAKING: Government officials confirm that aliens have been living among us for decades and are secretly controlling world governments. According to leaked documents, extraterrestrial beings have been influencing major political decisions since the 1950s. The documents allegedly show evidence of alien technology being used in modern smartphones and that all world leaders are actually alien-human hybrids.",
            tech: "Apple announces its new M4 chip will feature revolutionary quantum processing capabilities, delivering up to 40% better performance than the M3 while consuming 25% less power. The chip, manufactured using a 3nm process, includes dedicated AI acceleration units and will debut in the next generation MacBook Pro expected to launch in early 2024."
        };
        
        // Load sample article
        function loadSample(type) {
            document.getElementById('newsText').value = samples[type];
        }
        
        // Switch between text and URL tabs
        function switchTab(tabType) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.background = '#f8f9fa';
                btn.style.color = '#333';
            });
            event.target.classList.add('active');
            event.target.style.background = '#0f9d58';
            event.target.style.color = 'white';
            
            // Update tab content
            document.getElementById('textTab').style.display = tabType === 'text' ? 'block' : 'none';
            document.getElementById('urlTab').style.display = tabType === 'url' ? 'block' : 'none';
        }
        
        // Load sample URLs
        function loadUrlSample(type) {
            const sampleUrls = {
                bbc: 'https://www.bbc.com/news',
                reuters: 'https://www.reuters.com/world/',
                cnn: 'https://www.cnn.com/world'
            };
            document.getElementById('newsUrl').value = sampleUrls[type];
        }
        
        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/cards/stats`);
                const data = await response.json();
                
                const total = data.total_predictions || 0;
                const realCount = data.by_prediction?.REAL?.count || 0;
                const fakeCount = data.by_prediction?.FAKE?.count || 0;
                const accuracy = total > 0 ? ((realCount + fakeCount) / total * 100).toFixed(1) : 0;
                
                document.getElementById('statsGrid').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${total.toLocaleString()}</div>
                        <div class="stat-label">Total Articles Analyzed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${realCount.toLocaleString()}</div>
                        <div class="stat-label">Real News Detected</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${fakeCount.toLocaleString()}</div>
                        <div class="stat-label">Fake News Detected</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${accuracy}%</div>
                        <div class="stat-label">System Accuracy</div>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load stats:', error);
                document.getElementById('statsGrid').innerHTML = `
                    <div class="stat-card" style="grid-column: 1 / -1;">
                        <div class="stat-label" style="color: #dc3545;">Failed to load statistics</div>
                    </div>
                `;
            }
        }
        
        // Load recent articles
        async function loadArticles() {
            try {
                const response = await fetch(`${API_BASE}/cards?limit=6`);
                const data = await response.json();
                
                if (data.cards && data.cards.length > 0) {
                    document.getElementById('articlesGrid').innerHTML = data.cards.map(card => `
                        <div class="article-card">
                            <div class="article-title">${card.title}</div>
                            <div class="article-content">${card.content}</div>
                            <div class="article-prediction ${card.prediction.toLowerCase()}">
                                ${card.prediction === 'REAL' ? '✓' : '⚠'} ${card.prediction} (${Math.round(card.confidence * 100)}%)
                            </div>
                            <div class="article-meta">
                                By ${card.username} • ${new Date(card.timestamp).toLocaleDateString()}
                            </div>
                            <div style="margin-top: 15px; display: flex; gap: 8px; flex-wrap: wrap;">
                                <button onclick="showExplanation('${card.id}')" class="sample-btn" style="font-size: 12px; padding: 4px 8px;">
                                    🧠 Explain
                                </button>
                                <button onclick="showSimilarArticles('${card.id}')" class="sample-btn" style="font-size: 12px; padding: 4px 8px;">
                                    🔍 Similar
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('articlesGrid').innerHTML = `
                        <div class="loading">No articles yet. Analyze your first article above!</div>
                    `;
                }
            } catch (error) {
                console.error('Failed to load articles:', error);
                document.getElementById('articlesGrid').innerHTML = `
                    <div class="loading" style="color: #dc3545;">Failed to load articles</div>
                `;
            }
        }
        
        // Text form submission handler
        document.getElementById('newsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newsText = document.getElementById('newsText').value.trim();
            const analyzeBtn = document.getElementById('analyzeBtn');
            const btnText = document.getElementById('btnText');
            const messageDiv = document.getElementById('message');
            
            if (!newsText) {
                messageDiv.innerHTML = '<div class="alert alert-error">Please enter some news text to analyze.</div>';
                return;
            }
            
            // Show loading state
            analyzeBtn.disabled = true;
            btnText.innerHTML = '<div class="loading-spinner"></div>Analyzing...';
            messageDiv.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text: newsText })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const prediction = data.prediction.result;
                    const confidence = Math.round(data.prediction.confidence * 100);
                    const emoji = prediction === 'REAL' ? '✅' : '⚠️';
                    
                    let explanationText = '';
                    if (data.explanation) {
                        explanationText = `<br><strong>AI Explanation:</strong> ${data.explanation.analysis_summary}`;
                    }
                    
                    let similarText = '';
                    if (data.similar_articles && data.similar_articles.length > 0) {
                        similarText = `<br><strong>Similar Articles:</strong> Found ${data.similar_articles.length} similar articles in database`;
                    }
                    
                    messageDiv.innerHTML = `
                        <div class="alert alert-success">
                            <strong>${emoji} Analysis Complete!</strong><br>
                            Prediction: <strong>${prediction}</strong><br>
                            Confidence: <strong>${confidence}%</strong>
                            ${explanationText}
                            ${similarText}
                        </div>
                    `;
                    
                    // Clear form
                    document.getElementById('newsText').value = '';
                    
                    // Reload data
                    setTimeout(() => {
                        loadStats();
                        loadArticles();
                    }, 500);
                } else {
                    messageDiv.innerHTML = `<div class="alert alert-error">Analysis failed: ${data.message}</div>`;
                }
            } catch (error) {
                console.error('Analysis failed:', error);
                messageDiv.innerHTML = '<div class="alert alert-error">Analysis failed. Please check your connection and try again.</div>';
            } finally {
                // Reset button state
                analyzeBtn.disabled = false;
                btnText.innerHTML = 'Analyze Article';
            }
        });
        
        // URL form submission handler
        document.getElementById('urlForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newsUrl = document.getElementById('newsUrl').value.trim();
            const analyzeBtn = document.getElementById('analyzeUrlBtn');
            const btnText = document.getElementById('urlBtnText');
            const messageDiv = document.getElementById('message');
            
            if (!newsUrl) {
                messageDiv.innerHTML = '<div class="alert alert-error">Please enter a valid URL to analyze.</div>';
                return;
            }
            
            // Show loading state
            analyzeBtn.disabled = true;
            btnText.innerHTML = '<div class="loading-spinner"></div>Extracting & Analyzing...';
            messageDiv.innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/analyze-url`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: newsUrl })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const prediction = data.prediction.result;
                    const confidence = Math.round(data.prediction.confidence * 100);
                    const emoji = prediction === 'REAL' ? '✅' : '⚠️';
                    const urlAnalysis = data.url_analysis;
                    
                    messageDiv.innerHTML = `
                        <div class="alert alert-success">
                            <strong>${emoji} URL Analysis Complete!</strong><br>
                            <strong>Article:</strong> ${urlAnalysis.title}<br>
                            <strong>Source:</strong> ${urlAnalysis.source_domain} 
                            <span style="color: ${urlAnalysis.credibility.color};">(${urlAnalysis.credibility.level} Credibility)</span><br>
                            <strong>Prediction:</strong> ${prediction}<br>
                            <strong>Confidence:</strong> ${confidence}%<br>
                            <strong>Sentiment:</strong> ${urlAnalysis.sentiment.sentiment} 
                            (${urlAnalysis.sentiment.emotional_level} emotional content)
                        </div>
                    `;
                    
                    // Clear form
                    document.getElementById('newsUrl').value = '';
                    
                    // Reload data
                    setTimeout(() => {
                        loadStats();
                        loadArticles();
                    }, 500);
                } else {
                    messageDiv.innerHTML = `<div class="alert alert-error">URL Analysis failed: ${data.message}</div>`;
                }
            } catch (error) {
                console.error('URL Analysis failed:', error);
                messageDiv.innerHTML = '<div class="alert alert-error">URL Analysis failed. Please check your connection and try again.</div>';
            } finally {
                // Reset button state
                analyzeBtn.disabled = false;
                btnText.innerHTML = 'Analyze URL';
            }
        });
        
        // Load monitoring data
        async function loadMonitoring() {
            try {
                const response = await fetch(`${API_BASE}/monitoring/dashboard`);
                const data = await response.json();
                
                if (data.success) {
                    const monitoring = data.monitoring_data;
                    
                    // Update monitoring stats
                    document.getElementById('monitoringGrid').innerHTML = `
                        <div class="stat-card" style="border-left: 4px solid #0f9d58;">
                            <div class="stat-number">${monitoring.last_24h_stats.total_analyzed}</div>
                            <div class="stat-label">Analyzed (24h)</div>
                        </div>
                        <div class="stat-card" style="border-left: 4px solid #dc3545;">
                            <div class="stat-number">${monitoring.last_24h_stats.fake_detected}</div>
                            <div class="stat-label">Fake Detected</div>
                        </div>
                        <div class="stat-card" style="border-left: 4px solid #28a745;">
                            <div class="stat-number">${monitoring.last_24h_stats.real_verified}</div>
                            <div class="stat-label">Real Verified</div>
                        </div>
                        <div class="stat-card" style="border-left: 4px solid ${monitoring.alert_level === 'high' ? '#dc3545' : monitoring.alert_level === 'medium' ? '#ffc107' : '#28a745'};">
                            <div class="stat-number">${monitoring.last_24h_stats.fake_percentage}%</div>
                            <div class="stat-label">Fake Rate</div>
                        </div>
                    `;
                    
                    // Update trending topics
                    if (monitoring.trending_topics.length > 0) {
                        document.getElementById('trendingList').innerHTML = monitoring.trending_topics.map(topic => `
                            <span style="display: inline-block; background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 6px 12px; margin: 4px; font-size: 14px; color: #333;">
                                📊 ${topic.topic} (${topic.count} articles)
                            </span>
                        `).join('');
                    } else {
                        document.getElementById('trendingList').innerHTML = '<p style="color: #666; font-style: italic;">No trending topics detected in the last 7 days.</p>';
                    }
                }
            } catch (error) {
                console.error('Failed to load monitoring data:', error);
                document.getElementById('monitoringGrid').innerHTML = `
                    <div class="stat-card" style="grid-column: 1 / -1;">
                        <div class="stat-label" style="color: #dc3545;">Failed to load monitoring data</div>
                    </div>
                `;
            }
        }
        
        // Refresh monitoring data
        function refreshMonitoring() {
            loadMonitoring();
        }
        
        // Show explanation modal
        function showExplanation(predictionId) {
            // This would open a modal with detailed explanation
            fetch(`${API_BASE}/explain/${predictionId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`Explanation: ${data.explanation.analysis_summary}`);
                    }
                })
                .catch(error => console.error('Failed to load explanation:', error));
        }
        
        // Show similar articles
        function showSimilarArticles(predictionId) {
            fetch(`${API_BASE}/similar/${predictionId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.similar_articles.length > 0) {
                        const similarList = data.similar_articles.map(article => 
                            `• ${article.title} (${article.similarity_percentage}% similar)`
                        ).join('\n');
                        alert(`Similar Articles Found:\n\n${similarList}`);
                    } else {
                        alert('No similar articles found.');
                    }
                })
                .catch(error => console.error('Failed to load similar articles:', error));
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadArticles();
            loadMonitoring();
        });
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            loadStats();
            loadArticles();
            loadMonitoring();
        }, 30000);
    </script>
</body>
</html>